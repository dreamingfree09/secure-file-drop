# Secure File Drop - Environment Variables Template
# Copy this file to .env and replace all placeholder values with real secrets.
# NEVER commit .env to version control.

# Postgres
POSTGRES_DB=sfd
POSTGRES_USER=sfd
POSTGRES_PASSWORD=CHANGE_ME_GENERATE_SECURE_PASSWORD

# MinIO
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=CHANGE_ME_GENERATE_SECURE_PASSWORD

# Backend (Admin auth + session)
SFD_ADMIN_USER=admin
SFD_ADMIN_PASS=CHANGE_ME_GENERATE_SECURE_PASSWORD
SFD_SESSION_SECRET=CHANGE_ME_USE_openssl_rand_hex_32

# Backend (Database)
DATABASE_URL=postgres://sfd:CHANGE_ME_GENERATE_SECURE_PASSWORD@postgres:5432/sfd?sslmode=disable

# MinIO / S3 configuration for backend access
SFD_S3_ENDPOINT=http://minio:9000
SFD_S3_ACCESS_KEY=minioadmin
SFD_S3_SECRET_KEY=CHANGE_ME_GENERATE_SECURE_PASSWORD
SFD_BUCKET=sfd-private

# Upload size limit (bytes, optional)
SFD_MAX_UPLOAD_BYTES=53687091200

# Download link signing secret
SFD_DOWNLOAD_SECRET=CHANGE_ME_USE_openssl_rand_hex_32

# Public base URL (for generating absolute download links)
SFD_PUBLIC_BASE_URL=https://localhost:8443

# SMTP configuration (optional; enables email notifications when provided)
SFD_SMTP_HOST=smtp.gmail.com
SFD_SMTP_PORT=587
SFD_SMTP_USER=your-email@gmail.com
SFD_SMTP_PASS=CHANGE_ME_GENERATE_SECURE_PASSWORD
SFD_SMTP_FROM=noreply@yourdomain.com

# File cleanup job configuration (optional)
SFD_CLEANUP_ENABLED=true        # Enable automated cleanup of old files (default: true)
SFD_CLEANUP_INTERVAL=1h         # How often to run cleanup (default: 1h, format: 1h, 30m, 24h)
SFD_CLEANUP_MAX_AGE=24h         # Delete files older than this in pending/failed states (default: 24h)

# Logging configuration (recommended for production)
SFD_LOG_FORMAT=json             # Log format: json or text (default: text, use json for production)
SFD_LOG_LEVEL=info              # Log level: debug, info, warn, error (default: info)
SFD_ENV=production              # Environment: development, production, staging (auto-enables JSON logs)

# Automated database backups (recommended for production)
SFD_BACKUP_ENABLED=true         # Enable automated database backups (default: false)
SFD_BACKUP_INTERVAL=24h         # Backup interval (default: 24h, format: 24h, 12h, 1h)
SFD_BACKUP_RETENTION_DAYS=7     # Number of days to keep backups (default: 7)
SFD_BACKUP_DIR=/var/backups/sfd # Directory to store backup files (default: /var/backups/sfd)
SFD_BACKUP_COMPRESSION=true     # Enable gzip compression for backups (default: true)
SFD_BACKUP_S3_ENABLED=true      # Upload backups to S3/MinIO (default: false, recommended: true)
SFD_BACKUP_S3_BUCKET=sfd-backups # S3 bucket for backups (required if S3 enabled)
SFD_BACKUP_S3_PREFIX=db-backups  # S3 prefix/folder for backups (default: backups)
SFD_BACKUP_NOTIFY_FAILURE=true  # Email notification on backup failure (default: true)
SFD_BACKUP_NOTIFY_SUCCESS=false # Email notification on backup success (default: false)

# -----------------------------------------------------------------------------
# How to generate secure secrets:
# -----------------------------------------------------------------------------
# openssl rand -hex 32       # for SFD_SESSION_SECRET and SFD_DOWNLOAD_SECRET
# openssl rand -base64 24    # for passwords (POSTGRES_PASSWORD, MINIO_ROOT_PASSWORD, etc.)
# htpasswd -bnBC 12 "" yourpassword | tr -d ':'  # for SFD_ADMIN_PASS (bcrypt hash)

# Monitoring configuration (optional)
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GENERATE_SECURE_PASSWORD  # Grafana admin password (default: admin)

# -----------------------------------------------------------------------------
# Production Features (auto-enabled, no configuration required):
# -----------------------------------------------------------------------------
# - Account lockout: 5 failed attempts, 15min lock, 10min window
# - Per-endpoint rate limiting: auth (10/min), upload (20/hr), download (100/hr), admin (50/min), api (300/min)
# - Request tracing: Correlation IDs auto-generated or accepted from X-Correlation-ID header
# - Prometheus metrics: Available at /metrics/prometheus
# - HTTP compression: Gzip for JSON/HTML responses
# - Circuit breakers: Database (5 failures/30s), MinIO (5/30s), SMTP (3/60s)
# - Configuration validation: All config validated at startup with detailed errors
# - Resumable uploads: TUS protocol at /upload/resumable
# - Connection pooling: Optimized (25 max, 5 idle, 5min lifetime)
